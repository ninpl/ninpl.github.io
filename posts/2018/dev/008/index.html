<!DOCTYPE html>
<html lang="">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>Estudio de UNET - N9&#43;</title><meta name="Description" content="un blog sobre mi, juegos, desarrollo y anime"><meta property="og:title" content="Estudio de UNET" />
<meta property="og:description" content="Esta entrada, es un recordatorio personal, después de hablar con amigos y de hablarme tan bien de UNET (Yo solo toque NET en Unity 3.5, :S), me entro el gusanico de ver esta nueva tecnología, por lo que decidí ponerme a investigar, pero descubrí que hay muy poca información sobre esto.
Detallo en más profundidad, hay información, pero del High API. Lo que yo quería ver es información sobre el Low API y de esto hay poco, asi que decidí crear esta entrada para guardar como recuerdo este estudio, por si próximamente tengo que volver a mirarlo (soy un neurótico del guardado de datos xD)." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ninpl.com/posts/2018/dev/008/" /><meta property="og:image" content="https://ninpl.com/avatar.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-07-16T17:18:59+02:00" />
<meta property="article:modified_time" content="2018-07-16T17:18:59+02:00" /><meta property="og:site_name" content="N9&#43;" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://ninpl.com/avatar.png"/>

<meta name="twitter:title" content="Estudio de UNET"/>
<meta name="twitter:description" content="Esta entrada, es un recordatorio personal, después de hablar con amigos y de hablarme tan bien de UNET (Yo solo toque NET en Unity 3.5, :S), me entro el gusanico de ver esta nueva tecnología, por lo que decidí ponerme a investigar, pero descubrí que hay muy poca información sobre esto.
Detallo en más profundidad, hay información, pero del High API. Lo que yo quería ver es información sobre el Low API y de esto hay poco, asi que decidí crear esta entrada para guardar como recuerdo este estudio, por si próximamente tengo que volver a mirarlo (soy un neurótico del guardado de datos xD)."/>
<meta name="application-name" content="Nineplus">
<meta name="apple-mobile-web-app-title" content="Nineplus"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://ninpl.com/posts/2018/dev/008/" /><link rel="prev" href="https://ninpl.com/posts/2018/comun/007/" /><link rel="next" href="https://ninpl.com/posts/2018/comun/008/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Estudio de UNET",
        "inLanguage": "",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/ninpl.com\/posts\/2018\/dev\/008\/"
        },"genre": "posts","keywords": "n9\u002b, dev","wordcount":  1519 ,
        "url": "https:\/\/ninpl.com\/posts\/2018\/dev\/008\/","datePublished": "2018-07-16T17:18:59+02:00","dateModified": "2018-07-16T17:18:59+02:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "N9+"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('dark' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'dark' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="N9&#43;"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/avatar.png"
        data-srcset="/avatar.png, /avatar.png 1.5x, /avatar.png 2x"
        data-sizes="auto"
        alt="/avatar.png"
        title="/avatar.png" /><span class="header-title-pre"><i class='fa fa-angle-right'></i></span><span id="id-1" class="typeit"></span></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/devblog/"><i class='fa-solid fa-gamepad'></i> devblog </a><a class="menu-item" href="/backdoor/"><i class='fa-solid fa-user-secret'></i> backdoor </a><a class="menu-item" href="https://github.com/ninpl" rel="noopener noreffer" target="_blank"><i class='fa-solid fa-code'></i> src </a><a class="menu-item" href="/perfil/"><i class='fa-solid fa-terminal'></i> nineplus </a><span class="menu-item delimiter"></span><a class="menu-item" href="https://github.com/ninpl" title="GitHub" rel="noopener noreffer" target="_blank"><i class="fa-brands fa-github-alt" aria-hidden="true"></i></a><a class="menu-item" href="https://gitlab.com/ninpl" title="Gitlab" rel="noopener noreffer" target="_blank"><i class="fa-brands fa-gitlab" aria-hidden="true"></i></a><a class="menu-item" href="https://trello.com/u/antoniomoon" title="Trello" rel="noopener noreffer" target="_blank"><i class="fa-brands fa-trello" aria-hidden="true"></i></a><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Busca títulos o contenido..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Buscar">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Limpiar">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Cambia el tema">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="N9&#43;"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/avatar.png"
        data-srcset="/avatar.png, /avatar.png 1.5x, /avatar.png 2x"
        data-sizes="auto"
        alt="/avatar.png"
        title="/avatar.png" /><span class="header-title-pre"><i class='fa fa-angle-right'></i></span><span id="id-2" class="typeit"></span></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Busca títulos o contenido..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Buscar">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Limpiar">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancelar
                    </a>
                </div><a class="menu-item" href="/devblog/" title=""><i class='fa-solid fa-gamepad'></i>devblog</a><a class="menu-item" href="/backdoor/" title=""><i class='fa-solid fa-user-secret'></i>backdoor</a><a class="menu-item" href="https://github.com/ninpl" title="" rel="noopener noreffer" target="_blank"><i class='fa-solid fa-code'></i>src</a><a class="menu-item" href="/perfil/" title=""><i class='fa-solid fa-terminal'></i>nineplus</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Cambia el tema">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><article class="feature-image">
        <div class="header-img" style="background-image: url('https://ninpl.com/img/b/b049.jpg')"></div>
		</header></div>
    <article class="page single"><h1 class="single-title animate__animated animate__flipInX">Estudio de UNET</h1><div class="content" id="content"><p>Esta entrada, es un recordatorio personal, después de hablar con amigos y de hablarme tan bien de UNET (Yo solo toque NET en Unity 3.5, :S), me entro el gusanico de ver esta nueva tecnología, por lo que decidí ponerme a investigar, pero descubrí que hay muy poca información sobre esto.</p>
<p>Detallo en más profundidad, <strong>hay información, pero del High API</strong>. Lo que yo quería ver es información sobre el Low API y de esto hay poco, asi que decidí crear esta entrada para guardar como recuerdo este estudio, por si próximamente tengo que volver a mirarlo (soy un neurótico del guardado de datos xD).</p>
<p>También agradecer a <strong>Alejandro Rivas y Fernando Galán</strong> por la ayuda e info que me dieron con libros y artículos.</p>
<h1 id="conceptos-necesarios">Conceptos necesarios</h1>
<p>Un <strong>sistema de red</strong> en videojuegos implica que los <strong>participantes pueden jugar juntos a través de la conexión entre ellos</strong> por medio de una red, ya sea una red de área local o el Internet. Esto quiere decir que uno o varios clientes se conectan a un servidor, para intercambiar datos.</p>
<hr>
<figure><a class="lightgallery" href="/img/c/unet.png" title="/img/c/unet.png" data-thumbnail="/img/c/unet.png" data-sub-html="<h2>.</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/c/unet.png"
            data-srcset="/img/c/unet.png, /img/c/unet.png 1.5x, /img/c/unet.png 2x"
            data-sizes="auto"
            alt="/img/c/unet.png" />
    </a><figcaption class="image-caption">.</figcaption>
    </figure>
<hr>
<p>En esencia, un <strong>cliente le dice al servidor lo que esta realizando y el servidor remite la información para todos los clientes</strong>, sincronizando sus estados. Este método se realiza desde cada cliente, haciendo asi que todos los clientes sean sincronizados por el servidor.</p>
<hr>
<figure><a class="lightgallery" href="/img/c/unet2.png" title="/img/c/unet2.png" data-thumbnail="/img/c/unet2.png" data-sub-html="<h2>.</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/c/unet2.png"
            data-srcset="/img/c/unet2.png, /img/c/unet2.png 1.5x, /img/c/unet2.png 2x"
            data-sizes="auto"
            alt="/img/c/unet2.png" />
    </a><figcaption class="image-caption">.</figcaption>
    </figure>
<hr>
<p>Se le suele llamar a un servidor, <strong>servidor dedicado, ya que solo efectúa el cambio de datos y no ejecuta ninguna instancia</strong>. Pero también existen otros tipos de servidores. Por ejemplo en Warcraft 3, cualquier cliente puede crear una partida desde su cliente, esto realmente es levantar un servidor para que otros jugadores puedan conectar con el como clientes, a la vez, el servidor también podrá ser un cliente.</p>
<hr>
<figure><a class="lightgallery" href="/img/c/unet3.png" title="/img/c/unet3.png" data-thumbnail="/img/c/unet3.png" data-sub-html="<h2>.</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/c/unet3.png"
            data-srcset="/img/c/unet3.png, /img/c/unet3.png 1.5x, /img/c/unet3.png 2x"
            data-sizes="auto"
            alt="/img/c/unet3.png" />
    </a><figcaption class="image-caption">.</figcaption>
    </figure>
<hr>
<p>Incluso se puede implementar una capa más, comúnmente llamada <strong>matchmaker</strong>, que es la instancia de un servidor que congrega las partidas de otros servidores, de esta forma los clientes conectan con el servidor principal, que este a su vez conecta con los demás servidores.</p>
<hr>
<figure><a class="lightgallery" href="/img/c/unet4.png" title="/img/c/unet4.png" data-thumbnail="/img/c/unet4.png" data-sub-html="<h2>.</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/c/unet4.png"
            data-srcset="/img/c/unet4.png, /img/c/unet4.png 1.5x, /img/c/unet4.png 2x"
            data-sizes="auto"
            alt="/img/c/unet4.png" />
    </a><figcaption class="image-caption">.</figcaption>
    </figure>
<hr>
<h1 id="empezamos-el-planteamiento">Empezamos el planteamiento</h1>
<figure><a class="lightgallery" href="/img/c/unet5.png" title="/img/c/unet5.png" data-thumbnail="/img/c/unet5.png" data-sub-html="<h2>.</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/c/unet5.png"
            data-srcset="/img/c/unet5.png, /img/c/unet5.png 1.5x, /img/c/unet5.png 2x"
            data-sizes="auto"
            alt="/img/c/unet5.png" />
    </a><figcaption class="image-caption">.</figcaption>
    </figure>
<p>Como siempre al final de la entrada dejo el <strong>link del repositorio en Github</strong> para los que quieran descargarlo. Doy por sentado que ya conocéis Unity y tenéis un conocimiento sobre su funcionamiento.</p>
<p>Lo primero que necesitaremos, sera un <strong>Manager para gestionar toda la información de nuestro servidor</strong>. Este Manager no puede desaparecer nunca, ya que si lo hace, el servidor y todas las <strong>conexiones se caerán</strong>.</p>
<p>Crearemos un objeto vació y le agregaremos el componente <strong>Network Manager que sera nuestro objeto para administrar la red</strong>.</p>
<hr>
<p>Este componente nos proporcionara mucha funcionalidad necesaria que podríamos escribirla desde cero pero ya que esta y no buscamos un sistema mega optimizado vamos a usarlo. Este componente ya lleva un valor booleano**(Dont destroy on load)** para decirle si queréis que el objeto sea destruido o que no se destruya nunca. También dispone de otro valor**(Run in Background)** para decidir si se ejecutara en segundo plano, Unity si no tiene este valor activado, al salir de Unity o del juego, se queda sin el foco y por lo tanto se pausa, esto seria malo si queremos que nuestros clientes reciban la información a tiempo.</p>
<figure><a class="lightgallery" href="/img/c/unet6.png" title="/img/c/unet6.png" data-thumbnail="/img/c/unet6.png" data-sub-html="<h2>.</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/c/unet6.png"
            data-srcset="/img/c/unet6.png, /img/c/unet6.png 1.5x, /img/c/unet6.png 2x"
            data-sizes="auto"
            alt="/img/c/unet6.png" />
    </a><figcaption class="image-caption">.</figcaption>
    </figure>
<p>Ahora vamos a agregarle un nuevo componente, llamado <strong>Network Manager HUD</strong>. Este componente nos facilita una <strong>interfaz con la funcionalidad necesaria</strong> para conectar con un servidor, levantar nuestro servidor o activar un matchmaker.</p>
<hr>
<p>Si construimos ahora mismo la aplicación, veremos como podemos crear dos o tres instancias de Unity y con ello poder conectarlas entre ellas.</p>
<p>Ahora que ya tenemos un administrador de red, tenemos que ver en sus opciones <strong>spawn info</strong>, una opción de player prefab. Esto nos indica que este cliente tiene que instanciar algo. Pero no se refiere a algo físico, sino que tiene que tener una instancia de jugador en memoria. Digamos que la siguiente manera como vemos en la siguiente imagen.</p>
<hr>
<figure><a class="lightgallery" href="/img/c/unet7.png" title="/img/c/unet7.png" data-thumbnail="/img/c/unet7.png" data-sub-html="<h2>.</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/c/unet7.png"
            data-srcset="/img/c/unet7.png, /img/c/unet7.png 1.5x, /img/c/unet7.png 2x"
            data-sizes="auto"
            alt="/img/c/unet7.png" />
    </a><figcaption class="image-caption">.</figcaption>
    </figure>
<hr>
<p>Cada jugador tiene que tener una <strong>presencia no física</strong>, es decir, pongamos el objeto que ponéis como spawn, es un objeto que posteriormente es destruido o desactivado, esto quitaría la presencia del cliente en el servidor, por que no tiene ninguna instancia. Por ello tenemos que realizar una buena praxis.</p>
<p>Creamos un objeto vació, <strong>que contendrá la información persistente del cliente/usuario</strong> y le <strong>agregaremos el componente network identity</strong>, que es un componente para obtener la identificación del objeto en la red. Luego crearemos su prefab y la agregaremos al prefab del spawn. Básicamente es un puntero a nuestro objeto de red.</p>
<p>Esto realiza más fácil la relación amor odio de nuestros clientes/servidor.</p>
<hr>
<blockquote>
<p><em><strong>Representación Dramática</strong></em></p>
</blockquote>
<blockquote>
<ul>
<li>Cliente : El jugador 18 tiene que moverse 3 pixeles a la derecha</li>
<li>Servidor : Sincronizando &hellip;</li>
<li>Cliente : Gracias</li>
</ul>
</blockquote>
<hr>
<figure><a class="lightgallery" href="/img/c/unet8.png" title="/img/c/unet8.png" data-thumbnail="/img/c/unet8.png" data-sub-html="<h2>.</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/c/unet8.png"
            data-srcset="/img/c/unet8.png, /img/c/unet8.png 1.5x, /img/c/unet8.png 2x"
            data-sizes="auto"
            alt="/img/c/unet8.png" />
    </a><figcaption class="image-caption">.</figcaption>
    </figure>
<figure><a class="lightgallery" href="/img/c/unet9.png" title="/img/c/unet9.png" data-thumbnail="/img/c/unet9.png" data-sub-html="<h2>.</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/c/unet9.png"
            data-srcset="/img/c/unet9.png, /img/c/unet9.png 1.5x, /img/c/unet9.png 2x"
            data-sizes="auto"
            alt="/img/c/unet9.png" />
    </a><figcaption class="image-caption">.</figcaption>
    </figure>
<hr>
<p>Ahora tenemos un pequeño problema. Si comprobamos cuando iniciamos dos instancias o mas, <strong>cada jugador instancia el mismo objeto</strong>. Vamos a cambiar eso.
He creado un script y se lo he agregado a nuestro prefab de player.</p>
<p>Empezaremos por sincronizar la instancia física del jugador, en nuestro caso un cubo con todas sus caras y vértices.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-C#" data-lang="C#"><span class="line"><span class="cl"><span class="c1">//                                  ┌∩┐(◣_◢)┌∩┐</span>
</span></span><span class="line"><span class="cl"><span class="c1">//																				\\</span>
</span></span><span class="line"><span class="cl"><span class="c1">// Player.cs (16/07/2018)														\\</span>
</span></span><span class="line"><span class="cl"><span class="c1">// Autor: Antonio Mateo (.\Moon Antonio) 	antoniomt.moon@gmail.com			\\</span>
</span></span><span class="line"><span class="cl"><span class="c1">// Descripcion:		Controller del jugador/Cliente.								\\</span>
</span></span><span class="line"><span class="cl"><span class="c1">// Fecha Mod:		16/07/2018													\\</span>
</span></span><span class="line"><span class="cl"><span class="c1">// Ultima Mod:		Version Inicial												\\</span>
</span></span><span class="line"><span class="cl"><span class="c1">//******************************************************************************\\</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#region Librerias</span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="err">#</span><span class="n">endregion</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nn">MoonAntonio</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">	<span class="cs">/// &lt;para&gt;Controller del jugador/Cliente.&lt;/para&gt;</span>
</span></span><span class="line"><span class="cl">	<span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">	<span class="k">public</span> <span class="k">class</span> <span class="nc">Player</span> <span class="p">:</span> <span class="n">MonoBehaviour</span> 
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="cp">#region Variables Publicas</span>
</span></span><span class="line"><span class="cl">		<span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">		<span class="cs">/// &lt;para&gt;Prefab del cubo para instanciar.&lt;/para&gt;</span>
</span></span><span class="line"><span class="cl">		<span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">		<span class="k">public</span> <span class="n">GameObject</span> <span class="n">prefabCubo</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="err">#</span><span class="n">endregion</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="cp">#region Inicializadores</span>
</span></span><span class="line"><span class="cl">		<span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl">		<span class="cs">/// &lt;para&gt;Inicializador de &lt;see cref=&#34;Player&#34;/&gt;.&lt;/para&gt;</span>
</span></span><span class="line"><span class="cl">		<span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl">		<span class="k">private</span> <span class="k">void</span> <span class="n">Start</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">Instantiate</span><span class="p">(</span><span class="n">prefabCubo</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="err">#</span><span class="n">endregion</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Solo tenéis que crear un gameobject, como el modelado o cualquier cubo como el nuestro y veréis su funcionamiento. Como vemos, <strong>esto es lo que realizaríamos si queremos crear un objeto en un single player</strong>, sin necesidad de ser multijugador, ahora vamos a realizar los cambios para poder crear la red.</p>
<p>Primero agregaremos <strong>using UnityEngine.Networking;</strong> y heredaremos nuestro script de <strong>NetworkBehaviour</strong> en vez de <strong>MonoBehaviour</strong>. Con esto lo que conseguimos es obtener acceso a la funcionalidad Net de Unity.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-C#" data-lang="C#"><span class="line"><span class="cl"><span class="k">private</span> <span class="k">void</span> <span class="n">Start</span><span class="p">()</span><span class="c1">// Inicializador de Player</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// Comprobamos si es el objeto local</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(!</span><span class="n">isLocalPlayer</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// Este objeto es de otro jugador</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Solo instanciara el cubo si es Local. Es decir, si soy el cliente.</span>
</span></span><span class="line"><span class="cl">	<span class="n">Instantiate</span><span class="p">(</span><span class="n">prefabCubo</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>De esta manera, si el objeto no es nuestro, no instanciaremos nada, ya que no es nuestra autoridad. Solo podemos darle autoridad sobre los clientes al servidor. Los demás clientes no tienen que tener autoridad sobre ningún cliente que no sea el suyo propio.</p>
<hr>
<figure><a class="lightgallery" href="/img/c/unet10.png" title="/img/c/unet10.png" data-thumbnail="/img/c/unet10.png" data-sub-html="<h2>.</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/c/unet10.png"
            data-srcset="/img/c/unet10.png, /img/c/unet10.png 1.5x, /img/c/unet10.png 2x"
            data-sizes="auto"
            alt="/img/c/unet10.png" />
    </a><figcaption class="image-caption">.</figcaption>
    </figure>
<hr>
<p>Bien, ahora con todo esto, tenemos que aprender unos nuevos conceptos. ¿Por que la instanciacion debe de realizarse desde el cliente? En realidad no, debería realizarse desde el servidor. Vamos a ver esto en mas profundidad.</p>
<p>En el método Start(), donde teníamos la instanciacion de nuestra unidad, deberíamos borrarla y colocar lo siguiente.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-C#" data-lang="C#"><span class="line"><span class="cl"><span class="c1">// Decir al servidor que instancie nuestra unidad</span>
</span></span><span class="line"><span class="cl"><span class="n">CmdSpawnUnidad</span><span class="p">();</span>
</span></span></code></pre></div><p>Simplemente indicamos que se llame a un método, lo interesante viene en ese método. <strong>Una nota antes de seguir, es ver que el prefijo del método es <code>Cmd</code></strong>, esto es una decisión que se tomo por parte de Unity3D, no se bien por que, pero es un protocolo a seguir si no quieres que te de un error. Todos los métodos que sean llamados desde el servidor deberán llevar el prefijo <strong>Cmd</strong>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-C#" data-lang="C#"><span class="line"><span class="cl"><span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// &lt;para&gt;Le dice al servidor que instancie la unidad.&lt;/para&gt;</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl"><span class="na">[Command]</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span> <span class="k">void</span> <span class="n">CmdSpawnUnidad</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">GInstantiate</span><span class="p">(</span><span class="n">prefabCubo</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Ahora en nuestro método, vemos como colocamos el atributo [Command], esto indica, que este método sera ejecutado por el servidor, en vez de por nuestro cliente. Por lo que creara el objeto y lo propagara hasta los clientes.</p>
<figure><a class="lightgallery" href="/img/c/unet11.png" title="/img/c/unet11.png" data-thumbnail="/img/c/unet11.png" data-sub-html="<h2>.</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/c/unet11.png"
            data-srcset="/img/c/unet11.png, /img/c/unet11.png 1.5x, /img/c/unet11.png 2x"
            data-sizes="auto"
            alt="/img/c/unet11.png" />
    </a><figcaption class="image-caption">.</figcaption>
    </figure>
<p>Al ejecutar os dará un error, esto es por que nuestro objeto Unidad, no tiene un identificador de red, es decir el componente NetworkIdentity. Todos los objetos que van a ser modificados por la red, tienen que tener un identificador.</p>
<p>También todos los objetos tienen que ser agregados en <strong>Registered Spawnable Prefabs</strong>.</p>
<hr>
<p>Después tenemos un atributo muy peculiar que puede ser agregado a las variables que necesiten que se sincronicen desde el servidor hasta los clientes. Este atributo es <strong>[SyncVar]</strong>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-C#" data-lang="C#"><span class="line"><span class="cl"><span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// &lt;para&gt;Nombre del player.&lt;/para&gt;</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl"><span class="na">[SyncVar]</span> <span class="k">public</span> <span class="kt">string</span> <span class="n">nombre</span> <span class="p">=</span> <span class="s">&#34;name&#34;</span><span class="p">;</span>
</span></span></code></pre></div><p>Ahora tenemos que usar el atributo <strong>RPC</strong>, que lo que realiza es que cuando llama el servidor a este método, es ejecutado en todos los clientes. Cuando usamos este atributo, también hay que modificar el prefijo con Rpc.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-C#" data-lang="C#"><span class="line"><span class="cl"><span class="cs">/// &lt;summary&gt;</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// &lt;para&gt;Cambia el nombre del jugador.&lt;/para&gt;</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// &lt;/summary&gt;</span>
</span></span><span class="line"><span class="cl"><span class="cs">/// &lt;param name=&#34;newNombre&#34;&gt;&lt;/param&gt;</span>
</span></span><span class="line"><span class="cl"><span class="na">[ClientRpc]</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span> <span class="k">void</span> <span class="n">RpcCambiarNombre</span><span class="p">(</span><span class="kt">string</span> <span class="n">newNombre</span><span class="p">)</span><span class="c1">// Cambia el nombre del jugador</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">nombre</span> <span class="p">=</span> <span class="n">newNombre</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>De momento eso es lo principal para poder crear las conexiones entre clientes y servidores. Animo a todo el mundo a descubrir esta especie de magia que seguro que os encantara como al 100% de la gente que aprende y terminareis construyendo e investigando mas y mas. Un saludo.</p>
<p>PD: Hay mucha mas info y cosillas que explicar, pero eso sera otra historia.</p>
<hr>

<a  href="https://bit.ly/3UKNOnm" target="_blank"  class="button">
  
  
  
    
  <i class="fa-brands fa-github-alt"></i>
    
  
  GitHub
  
</a>
<hr>
<figure><a class="lightgallery" href="/img/ref.png" title="/img/ref.png" data-thumbnail="/img/ref.png" data-sub-html="<h2>.</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/ref.png"
            data-srcset="/img/ref.png, /img/ref.png 1.5x, /img/ref.png 2x"
            data-sizes="auto"
            alt="/img/ref.png" />
    </a><figcaption class="image-caption">.</figcaption>
    </figure>
</div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2015 - 2025</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://ninpl.com" target="_blank">N9&#43;</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Volver arriba">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="Ver comentarios">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/css/lightgallery-bundle.min.css"><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.stemmer.support.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.es.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/lightgallery.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/thumbnail/lg-thumbnail.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/zoom/lg-zoom.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/typeit@8.6.0/dist/index.umd.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copiar al portapapeles","maxShownLines":50},"comment":{},"data":{"id-1":" N9+","id-2":" N9+"},"lightgallery":true,"search":{"highlightTag":"em","lunrIndexURL":"/index.json","lunrLanguageCode":"es","maxResultLength":10,"noResultsFound":"No se encontraron resultados","snippetLength":30,"type":"lunr"},"typeit":{"cursorChar":"|","cursorSpeed":1000,"data":{"id-1":["id-1"],"id-2":["id-2"]},"duration":-1,"speed":100}};</script><script type="text/javascript" src="/js/theme.min.js"></script><script type="text/javascript">
            window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());
            gtag('config', 'G-V17LGH4N3N', { 'anonymize_ip': true });
        </script><script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=G-V17LGH4N3N" async></script></body>
</html>
