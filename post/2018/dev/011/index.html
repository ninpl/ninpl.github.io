<!DOCTYPE html>
<html lang="es-es">
<head>
	<title>Localización usando .PO&middot; Antonio Moon´s</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="author" content="Moon Antonio">
	<meta name="description" content="un blog sobre mi, juegos, desarrollo y anime">
	<meta name="keywords" content="Moon,Antonio,Dev,Game">
	<meta name="generator" content="Hugo 0.55.4" />

	<!-- CSS -->
	<link rel="stylesheet" href="https://moonantonio.github.io/css/main.css">

	<!--Favicon-->
	<link rel="shortcut icon" href="https://moonantonio.github.io/favicon.ico" type="image/x-icon">

	

	<!-- Font Awesome -->
	<link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

	<!-- Google Fonts -->
	<link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700,700italic,400italic" rel="stylesheet" type="text/css">
</head>

<body>
	<header class="site-header">
	<div class="branding">
		<a href="https://moonantonio.github.io/">
		<img class="avatar" src="https://moonantonio.github.io/img/avatar.png" alt="avatar"/>
		</a>
		<h1 class="site-title">
			<a href="https://moonantonio.github.io/">Antonio Moon´s</a>
		</h1>
	</div>
	<nav class="site-nav">

		<ul>
			<li><a href="/about/">  </a></li>

			<li class="list-group">
  <a class="list-group-item" href="https://moonantonio.github.io/tags/devblog/" title="devBlog">
  		</i>&nbsp; devBlog</a> <i class="fa fa-gamepad" aria-hidden="true"></i>
  </a>
</li>

<li class="list-group">
  <a class="list-group-item" href="https://moonantonio.github.io/backdoor" title="BackDoor">
  		</i>&nbsp; BackDoor</a> <i class="fa fa-black-tie" aria-hidden="true"></i>
  </a>
</li>

<li class="list-group">
  <a class="list-group-item" href="https://github.com/MoonAntonio/rec.repos" title="Public">
  		</i>&nbsp; Publico</a> <i class="fa fa-code" aria-hidden="true"></i>
  </a>
</li>

<li class="list-group">
  <a class="list-group-item" href="https://moonantonio.github.io/portfolio/" title="About">
  		</i>&nbsp; About</a> <i class="fa fa-terminal" aria-hidden="true"></i>
  </a>
</li>

<li class="icon">
	<a href="https://moonantonio.github.io/" title="&#43;">
		</i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;•&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</i>
	</a>
</li>

<li class="icon">
	<a href="https://moonantonio.github.io/" title="">
		<i class="fa fa-fw fa-home"></i>
	</a>
</li>

<li class="icon">
	<a href="https://moonantonio.github.io/index.xml" title="Subscribirte">
		<i class="fa fa-fw fa-rss"></i>
	</a>
</li>

<li class="icon">
	<a href="mailto:antoniomt.moon@gmail.com" title="Email">
		<i class="fa fa-fw fa-envelope"></i>
	</a>
</li>



<li class="icon">
	<a href="https://bitbucket.org/MoonAntonio" title="Bitbucket">
		<i class="fa fa-fw fa-bitbucket"></i>
	</a>
</li>







<li class="icon">
	<a href="https://github.com/MoonAntonio" title="GitHub">
		<i class="fa fa-fw fa-github"></i>
	</a>
</li>

























<li class="icon">
	<a href="https://trello.com/antoniomoon" title="Trello">
		<i class="fa fa-fw fa-trello"></i>
	</a>
</li>

<li class="icon">
	<a href="https://gitlab.com/MoonAntonio" title="Gitlab">
		<i class="fa fa-fw fa-gitlab"></i>
	</a>
</li>


		</ul>
	</nav>
</header>


	<div class="content">
	<article class="feature-image">
		<header style="background-image: url('https://moonantonio.github.io/img/bg.png')">
			<h1 class="title">Localización usando .PO</h1>
		</header>

		<section class="post-content">
			

<p>Traducir un juego a múltiples idiomas es una forma muy efectiva de exponerlo a nuevas audiencias. Sin embargo, puede convertirse en un verdadero dolor de cabeza si no lo hace de forma extensible y mantenible. Un sistema .po es una gran manera de administrar traducciones, y es un sistema útil para saber más que solo juegos. Analizaré formas en que puede ampliar el sistema para que sea más robusto, pero la mayoría de los detalles de estos dependen demasiado de su configuración para ser detallados por completo.</p>

<p>Algo a tener en cuenta cuando decida traducir, es que su juego ya debería estar en un estado bastante maduro, ya que hacer traducciones (especialmente por los fanáticos) es difícil lograr que se actualicen cada vez que cambia o agrega texto.</p>

<p>Algunas cosas que ya debería haber configurado al entrar en esto son algún tipo de sistema de configuración, así como un sistema de interfaz de usuario y un objeto global DontDestroyOnLoad al que tiene acceso su UI.</p>

<p>Lo más probable es que lo actualice en algún momento, ya que incluso al escribir esto noté algunas optimizaciones que podría estar haciendo.</p>

<h2 id="traducciones">Traducciones</h2>

<p>Omita esta sección si solo quiere ver el flujo de trabajo, pero encontré que este sistema es útil para que los fanáticos me traduzcan las cosas. Lo mejor que puedes hacer es crear una hoja de cálculo de Google Drive y compartir el enlace con los fanáticos, que puedes encontrar haciendo publicaciones en los distintos centros para tu juego. Debajo hay un enlace a mi hoja de cálculo de muestra que puedes guardar en tu propia unidad y usar.</p>

<p><a href="http://bit.ly/2ztE2OT">Link Google</a></p>

<h2 id="el-archivo-po">El archivo .PO</h2>

<p>¿Qué es un archivo .po (objeto portátil)?. Es una parte del estándar gettext, y se describe en el proyecto GNU de esta manera:</p>

<p>Un archivo PO se compone de muchas entradas, cada entrada mantiene la relación entre una cadena original no traducida y su correspondiente traducción. Todas las entradas en un archivo PO generalmente pertenecen a un solo proyecto, y todas las traducciones se expresan en un solo idioma de destino. Una entrada de archivo PO tiene la siguiente estructura esquemática:</p>

<hr />

<pre><code>white-space
#  translator-comments
#. extracted-comments
#: reference…
#, flag…
#| msgid previous-untranslated-string
msgid untranslated-string
msgstr translated-string
</code></pre>

<hr />

<p>¿Y qué? ¿Es solo un archivo con una clave y un valor y algunos metadatos? No del todo, hay dos partes más para usar un sistema .po que lo haga brillar realmente. Los archivos .pot y los editores.</p>

<p>Un .pot (Portable Object Template) es lo que se usa para generar sus archivos .po en un editor, y se puede usar para actualizar sus archivos .po cuando agrega nuevas traducciones. Tiene la misma estructura exacta que un archivo .po normal, pero con una cadena traducida vacía.</p>

<p>¡No intente administrar traducciones agregando entradas a archivos .po, actualice desde .pot para garantizar la coherencia!</p>

<p>El editor más popular es Poedit. Que se ve así, he marcado con un círculo el botón &lsquo;Actualizar desde POT&rsquo;:</p>

<p><center>[<img src="/img/case/po01.jpg" alt="01" />]</center></p>

<h2 id="implementación-con-unity3d">Implementación con Unity3D</h2>

<p>Es probable que este sistema necesite ajustes en su situación exacta, pero intentaré mantenerlo lo más genérico posible. Aunque algunos de los pasos que tendrá que averiguar sera, dónde llamar algunas cosas por su cuenta. Vamos a usar las cadenas en inglés como nuestras teclas, ¡esto es muy importante! Mantenga su .pot actualizado. La idea es que dado que el juego comenzará en inglés cada vez que podamos tomar los valores predeterminados para el cuadro de texto y usarlos como ambas claves y los valores del idioma inglés.</p>

<p>Los archivos principales con los que trabajaremos son:</p>

<ul>
<li>template.pot - Almacenado en Recursos/Idiomas (crear si no existe)</li>
<li>spanish.po - Almacenado en Recursos/Idiomas (crear si no existe)</li>
<li>LanguageManager.cs: adjunto y referenciado por el administrador de juego global persistente</li>
<li>UILocalizeText.cs: se adjunta a cada objeto de texto de UI, controla la actualización de ese texto</li>
</ul>

<p>Debe adjuntar UILocalizeText.cs a cada cuadro de texto que desee traducir y tener un valor para él en los archivos .po y .pot.</p>

<p>Convierta LanguageManger en un objeto global no destruir en la carga, llame a LoadLanguage() cuando cambie de idioma y luego UpdateAllTextBoxes() cuando necesite actualizar su UI.</p>

<p>Nota: desde que actualicé Unity, parece que no reconoce los archivos .po como archivos de texto y no puede encontrar los archivos de traducción. Agregar .txt después de .po lo corrige (es decir, spanish.po.txt), pero para cargarlo en Poedit debe escribir el nombre en el cuadro de diálogo.</p>

<h2 id="scripts">Scripts</h2>

<p>En los siguientes scripts todo lo que dice YourGameManager debe ser reemplazado por sus sistemas. Intenté comentar los archivos para ser bastante descriptivos.</p>

<p>Para configurar y usar estos:
1 - Crea tres cuadros de texto con valores que corresponden a los valores en template.pot
2 - Adjunte UILocalizeText.cs a estos cuadros de texto
3 - Init LevelManager.cs
4 - LoadLanguage (&ldquo;español&rdquo;)
5 - UpdateAllTextBoxes()</p>

<h3 id="template-pot">Template.POT</h3>

<hr />

<pre><code>#, fuzzy
msgid &quot;&quot;
msgstr &quot;&quot;
&quot;Project-Id-Version: Test\n&quot;
&quot;POT-Creation-Date: 2017-02-12 09:12-0500\n&quot;
&quot;PO-Revision-Date: 2015-10-27 19:11-0400\n&quot;
&quot;Last-Translator: \n&quot;
&quot;Language-Team: \n&quot;
&quot;Language: en\n&quot;
&quot;MIME-Version: 1.0\n&quot;
&quot;Content-Type: text/plain; charset=UTF-8\n&quot;
&quot;Content-Transfer-Encoding: 8bit\n&quot;
&quot;X-Generator: Poedit 1.8.11\n&quot;
&quot;X-Poedit-Basepath: .\n&quot;
&quot;Plural-Forms: nplurals=2; plural=(n != 1);\n&quot;
&quot;X-Poedit-KeywordsList: --keyword[-]\n&quot;
&quot;X-Poedit-SearchPath-0: .\n&quot;

msgid &quot;GOLD&quot;
msgstr &quot;&quot;

msgid &quot;SILVER&quot;
msgstr &quot;&quot;

msgid &quot;BRONZE&quot;
msgstr &quot;&quot;
</code></pre>

<hr />

<h3 id="spanish-po-txt">Spanish.po.txt</h3>

<hr />

<pre><code>#, fuzzy
msgid &quot;&quot;
msgstr &quot;&quot;
&quot;Project-Id-Version: Test\n&quot;
&quot;POT-Creation-Date: 2017-02-12 09:12-0500\n&quot;
&quot;PO-Revision-Date: 2015-10-27 19:11-0400\n&quot;
&quot;Last-Translator: \n&quot;
&quot;Language-Team: \n&quot;
&quot;Language: en\n&quot;
&quot;MIME-Version: 1.0\n&quot;
&quot;Content-Type: text/plain; charset=UTF-8\n&quot;
&quot;Content-Transfer-Encoding: 8bit\n&quot;
&quot;X-Generator: Poedit 1.8.11\n&quot;
&quot;X-Poedit-Basepath: .\n&quot;
&quot;Plural-Forms: nplurals=2; plural=(n != 1);\n&quot;
&quot;X-Poedit-KeywordsList: --keyword[-]\n&quot;
&quot;X-Poedit-SearchPath-0: .\n&quot;

msgid &quot;GOLD&quot;
msgstr &quot;ORO&quot;

msgid &quot;SILVER&quot;
msgstr &quot;PLATA&quot;

msgid &quot;BRONZE&quot;
msgstr &quot;BRONCE&quot;
</code></pre>

<hr />

<h3 id="languajemanager-cs">LanguajeManager.cs</h3>

<hr />

<pre><code class="language-C#">using UnityEngine;
using System.Collections;
using System.IO;
using System.Collections.Generic;
using System;

public class LanguageManager : MonoBehaviour
{
    //This is where the current loaded language will go
    private static Hashtable textTable;

    [HideInInspector]
    //Just a reference for the current language, default to english
    public string CurrentLanguage = &quot;english&quot;;

    //Run this when you are ready to start the language process, you usually want to do this after everything has loaded
    public void Init()
    {
        //You should use an enum for storing settings that are a unique list,
        //This gets a string representation of an enum, 
        CurrentLanguage = Enum.GetName(typeof(Settings.Languages), (int)YourGameManager.Settings.Language);

        //Pass that language into LoadLanguage, remember we are in init so this should only run once.
        LoadLanguage(CurrentLanguage);
    }

    //You call this when you want to update all text boxes with the new translation.
    //Run this after Init
    //Run this whenever you run LoadLanguage
    //Run this whenever you load a new scene and want to translate the new UI
    public void UpdateAllTextBoxes()
    {      
        //Find all active and inactive text boxes and loop through 'em
        UILocalizeText[] temp = Resources.FindObjectsOfTypeAll&lt;UILocalizeText&gt;();
        foreach (UILocalizeText text_box in temp)
        {
            //Run the update translation function on each text 
            text_box.UpdateTranslation();
        }
    }

    //Run this whenever a language changes, like in when a setting is changed - then run UpdateAllTextBoxes
    //This is based off of http://wiki.unity3d.com/index.php?title=TextManager, though heavily modified and expanded
    public void LoadLanguage(string lang)
    {
        CurrentLanguage = lang;

        if(lang == &quot;english&quot;)
        {
            UpdateAllTextBoxes();
        }
        else if (lang != &quot;english&quot;)
        {
            string fullpath = &quot;Languages/&quot; + lang + &quot;.po&quot;; // the file is actually &quot;.txt&quot; in the end

            TextAsset textAsset = (TextAsset)Resources.Load(fullpath);
            if (textAsset == null)
            {
                Debug.Log(&quot;[TextManager] &quot; + fullpath + &quot; file not found.&quot;);
                return;
            } else
            {
                Debug.Log(&quot;[TextManager] loading: &quot; + fullpath);

                if (textTable == null)
                {
                    textTable = new Hashtable();
                }

                textTable.Clear();

                StringReader reader = new StringReader(textAsset.text);
                string key = null;
                string val = null;
                string line;
                while ((line = reader.ReadLine()) != null)
                {
                    if (line.StartsWith(&quot;msgid \&quot;&quot;))
                    {
                        key = line.Substring(7, line.Length - 8).ToUpper();
                    }
                    else if (line.StartsWith(&quot;msgstr \&quot;&quot;))
                    {
                        val = line.Substring(8, line.Length - 9);
                    }
                    else
                    {
                        if (key != null &amp;&amp; val != null)
                        {
                            // TODO: add error handling here in case of duplicate keys
                            textTable.Add(key, val);
                            key = val = null;
                        }
                    }
                }

                reader.Close();
            }
        }
    }

    //This handles selecting the value from the translation array and returning it, the UILocalizeText calls this
    public string GetText(string key)
    {
        string result = &quot;&quot;;
        if (key != null &amp;&amp; textTable != null)
        {
            if (textTable.ContainsKey(key))
            {
                result = (string)textTable[key];

            } else
            {

            }
        }
        return (string)result;
    }
}
</code></pre>

<hr />

<p>###UILocalizeText.cs</p>

<hr />

<pre><code class="language-C#">using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.UI;

public class UILocalizeText : MonoBehaviour {

    //This instances key, as well as the english translation
    [HideInInspector]
    public string TranslationKey = &quot;&quot;;

    [HideInInspector]
    public Text TextToTranslate;

    //References to text values
    string OriginalText = &quot;&quot;;
    string TranslatedText = &quot;&quot;;

    //This gets run automatically if the original text hasn't been set when you go to update it. 
    //You shouldn't need to manually run this from anywhere
    public void Init()
    {
        //Grab the TextToTranslate if we haven't
        if(TextToTranslate == null)
            TextToTranslate = GetComponent&lt;Text&gt;();

        //Grab the original value of the text before we update it
        if(TextToTranslate != null)
            OriginalText = TextToTranslate.text;

        //Set the translation key to the original english text
        if(TranslationKey == &quot;&quot;)
            TranslationKey = OriginalText;
    }

    //This gets called from LanguageManager
    //One thing I noticed is that it might be nicer to just pass in the correct string to this rather than go grap it from LanguageManager
    public void UpdateTranslation()
    {
        //If original text is empty, then this object hasn't been initiated so it should do that 
        if (OriginalText == &quot;&quot;)
            Init();

        //If the object has no Text object then we shouldn't try to set the text so just stop
        if (TextToTranslate == null) return;

        if(YourGameManager.LanguageManager.CurrentLanguage != &quot;english&quot; &amp;&amp; TranslationKey != &quot;&quot;)
        {
            string new_text = YourGameManager.LanguageManager.GetText(TranslationKey.ToUpper());

            if (new_text != &quot;&quot;)
            {
                TextToTranslate.text = new_text;
            } else
            {
               // Debug.Log(&quot;Key &quot; + OriginalText + &quot; doesn't have an entry in this language&quot;);
            }
        } else if(YourGameManager.LanguageManager.CurrentLanguage == &quot;english&quot;)
        {
            if(TextToTranslate != null &amp;&amp; OriginalText != null)
                TextToTranslate.text = OriginalText;
        }

    }

}
</code></pre>

<hr />

<p>Bueno con esto, puedes hacer la prueba y comprobar que ya tienes un sistema simple para traducir tu juego a diversos idiomas.</p>

<p>.\Moon</p>


			

			
				<hr>
				

<h3>Relacionado</h3>
<ul>
	
	<li><a href="/post/2018/dev/010/">¡Consejos esenciales de Gamedev &amp; Unity!</a></li>
	
	<li><a href="/post/2018/dev/009/">Unity : Aseprite Workflow</a></li>
	
	<li><a href="/post/2018/dev/008/">Estudio de UNET</a></li>
	
	<li><a href="/post/2018/dev/002/">ScriptableObjects</a></li>
	
	<li><a href="/post/2018/dev/001/">MonoBehavior en Unity</a></li>
	
</ul>

			
		</section>
	</article>
	</div>

	<footer class="site-footer">
	<p class="text">&copy; 2020 - Moon Antonio</p>
</footer>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-89564434-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

</body>
</html>
